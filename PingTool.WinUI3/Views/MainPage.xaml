<Page
    x:Class="PingTool.Views.MainPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:converters="using:PingTool.Converters"
    mc:Ignorable="d"
    KeyDown="Page_KeyDown">

    <Page.Resources>
        <converters:TextColorConverter x:Key="TextColorConverter" />
    </Page.Resources>

    <ScrollViewer>
        <Grid Padding="24,16">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <!-- Header Section -->
            <Grid Margin="0,0,0,20">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- App Title -->
                <StackPanel Orientation="Horizontal" Spacing="12">
                    <Border 
                        Width="44" Height="44" 
                        CornerRadius="10"
                        Background="{StaticResource AccentGradientBrush}">
                        <FontIcon 
                            FontFamily="{StaticResource SymbolThemeFontFamily}" 
                            Glyph="&#xE968;" 
                            FontSize="22"
                            Foreground="White"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"/>
                    </Border>
                    <StackPanel VerticalAlignment="Center">
                        <TextBlock Text="Ping Legacy" FontSize="22" FontWeight="Bold"/>
                        <TextBlock 
                            Text="Network Diagnostic Tool" 
                            FontSize="12" 
                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                    </StackPanel>
                </StackPanel>

                <!-- Search & Controls -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8">
                    <!-- Favorites Dropdown -->
                    <DropDownButton ToolTipService.ToolTip="Quick Hosts (Ctrl+F to add)">
                        <StackPanel Orientation="Horizontal" Spacing="6">
                            <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" Glyph="&#xE728;" FontSize="14"/>
                            <TextBlock Text="Favorites"/>
                        </StackPanel>
                        <DropDownButton.Flyout>
                            <MenuFlyout>
                                <MenuFlyoutItem Text="8.8.8.8" Click="FavoriteItem_Click"/>
                                <MenuFlyoutItem Text="1.1.1.1" Click="FavoriteItem_Click"/>
                                <MenuFlyoutItem Text="google.com" Click="FavoriteItem_Click"/>
                                <MenuFlyoutItem Text="cloudflare.com" Click="FavoriteItem_Click"/>
                                <MenuFlyoutSeparator/>
                                <MenuFlyoutItem Text="Add Current Host" Click="AddFavorite_Click">
                                    <MenuFlyoutItem.Icon>
                                        <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" Glyph="&#xE710;"/>
                                    </MenuFlyoutItem.Icon>
                                </MenuFlyoutItem>
                            </MenuFlyout>
                        </DropDownButton.Flyout>
                    </DropDownButton>

                    <Border 
                        Background="{ThemeResource ControlFillColorDefaultBrush}"
                        BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="4,0">
                        <StackPanel Orientation="Horizontal">
                            <TextBox
                                x:Name="TxtAddress"
                                Width="200"
                                BorderThickness="0"
                                Background="Transparent"
                                PlaceholderText="Enter IP or hostname..."
                                Text="{x:Bind ViewModel.HostNameOrAddress, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                KeyDown="TxtAddress_KeyDown"
                                VerticalAlignment="Center"/>
                            <Button 
                                Command="{x:Bind ViewModel.StartPingCommand}"
                                Style="{StaticResource AccentButtonStyle}"
                                CornerRadius="6"
                                Padding="14,8"
                                ToolTipService.ToolTip="Start: F5 | Stop: Esc">
                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <SymbolIcon Symbol="{x:Bind GetStartStopSymbol(ViewModel.IsPingStarted), Mode=OneWay}"/>
                                    <TextBlock Text="{x:Bind GetStartStopText(ViewModel.IsPingStarted), Mode=OneWay}" FontWeight="SemiBold"/>
                                </StackPanel>
                            </Button>
                        </StackPanel>
                    </Border>

                    <Button 
                        Command="{x:Bind ViewModel.ClearPingCommand}" 
                        ToolTipService.ToolTip="Clear (Ctrl+D)"
                        Style="{StaticResource IconButtonStyle}">
                        <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" Glyph="&#xE74D;" FontSize="16"/>
                    </Button>
                    <Button 
                        Command="{x:Bind ViewModel.ExportCommand}" 
                        ToolTipService.ToolTip="Export (Ctrl+E)"
                        Style="{StaticResource IconButtonStyle}">
                        <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" Glyph="&#xE78C;" FontSize="16"/>
                    </Button>
                </StackPanel>
            </Grid>

            <!-- Network Info & Status Row -->
            <Grid Grid.Row="1" Margin="0,0,0,16">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Network Info Card -->
                <Border Style="{StaticResource ModernCardStyle}" Margin="0,0,8,0">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Spacing="8" Margin="0,0,0,12">
                            <Border 
                                Width="28" Height="28" 
                                CornerRadius="6"
                                Background="{StaticResource AccentGradientBrush}">
                                <FontIcon 
                                    FontFamily="{StaticResource SymbolThemeFontFamily}" 
                                    Glyph="&#xE968;" 
                                    FontSize="12"
                                    Foreground="White"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"/>
                            </Border>
                            <TextBlock Text="Network Info" FontWeight="SemiBold" FontSize="14" VerticalAlignment="Center"/>
                        </StackPanel>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <TextBlock Text="IP Address" FontWeight="SemiBold" Margin="0,4"/>
                            <TextBlock Grid.Column="1" Text=":" Margin="8,4"/>
                            <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8">
                                <TextBlock Text="{x:Bind ViewModel.IpAddress, Mode=OneWay}" Margin="0,4"/>
                                <Button Command="{x:Bind ViewModel.CopyIpAddressCommand}" Padding="4" Background="Transparent" BorderThickness="0">
                                    <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" Glyph="&#xE8C8;" FontSize="12"/>
                                </Button>
                            </StackPanel>

                            <TextBlock Grid.Row="1" Text="IP Type" FontWeight="SemiBold" Margin="0,4"/>
                            <TextBlock Grid.Row="1" Grid.Column="1" Text=":" Margin="8,4"/>
                            <TextBlock Grid.Row="1" Grid.Column="2" Text="{x:Bind ViewModel.IpType, Mode=OneWay}" Margin="0,4"/>

                            <TextBlock Grid.Row="2" Text="Profile" FontWeight="SemiBold" Margin="0,4"/>
                            <TextBlock Grid.Row="2" Grid.Column="1" Text=":" Margin="8,4"/>
                            <StackPanel Grid.Row="2" Grid.Column="2" Orientation="Horizontal" Spacing="8">
                                <TextBlock Text="{x:Bind ViewModel.ProfileName, Mode=OneWay}" Margin="0,4"/>
                                <FontIcon 
                                    FontFamily="{StaticResource SymbolThemeFontFamily}" 
                                    Glyph="{x:Bind GetConnectionGlyph(ViewModel.IsWlan), Mode=OneWay}" 
                                    FontSize="14"/>
                            </StackPanel>

                            <TextBlock Grid.Row="3" Text="Data (MB)" FontWeight="SemiBold" Margin="0,4"/>
                            <TextBlock Grid.Row="3" Grid.Column="1" Text=":" Margin="8,4"/>
                            <StackPanel Grid.Row="3" Grid.Column="2" Orientation="Horizontal" Spacing="4" Margin="0,4">
                                <TextBlock Text="{x:Bind ViewModel.TotalReceivedBytes, Mode=OneWay}"/>
                                <SymbolIcon Symbol="Download" />
                                <TextBlock Text="/"/>
                                <TextBlock Text="{x:Bind ViewModel.TotalSentBytes, Mode=OneWay}"/>
                                <SymbolIcon Symbol="Upload" />
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Network Status Visualization -->
                <Border Grid.Column="1" Style="{StaticResource ModernCardStyle}" Margin="8,0" Padding="24,16">
                    <StackPanel HorizontalAlignment="Center">
                        <TextBlock Text="Network Status" FontWeight="SemiBold" FontSize="14" HorizontalAlignment="Center" Margin="0,0,0,16"/>
                        <StackPanel Orientation="Horizontal" Spacing="0" HorizontalAlignment="Center">
                            <!-- Computer -->
                            <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" Glyph="&#xEC4E;" FontSize="36"/>
                            <!-- Line -->
                            <Border Width="40" Height="2" Background="{ThemeResource TextFillColorSecondaryBrush}" VerticalAlignment="Center"/>
                            <!-- WiFi/Network Icon -->
                            <StackPanel>
                                <FontIcon 
                                    FontFamily="{StaticResource SymbolThemeFontFamily}" 
                                    Glyph="{x:Bind GetConnectionGlyph(ViewModel.IsWlan), Mode=OneWay}"
                                    FontSize="24"
                                    Foreground="{x:Bind GetConnectionColor(ViewModel.HasInternetAccess), Mode=OneWay}"/>
                                <TextBlock 
                                    Text="{x:Bind ViewModel.ProfileName, Mode=OneWay}" 
                                    FontSize="10" 
                                    HorizontalAlignment="Center"
                                    MaxWidth="80"
                                    TextTrimming="CharacterEllipsis"/>
                            </StackPanel>
                            <!-- Line -->
                            <Border Width="40" Height="2" Background="{ThemeResource TextFillColorSecondaryBrush}" VerticalAlignment="Center"/>
                            <!-- Globe (Internet) -->
                            <FontIcon 
                                FontFamily="{StaticResource SymbolThemeFontFamily}" 
                                Glyph="&#xE774;" 
                                FontSize="36"
                                Foreground="{x:Bind GetConnectionColor(ViewModel.HasInternetAccess), Mode=OneWay}"/>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- Ping Stats Summary -->
                <Border Grid.Column="2" Style="{StaticResource ModernCardStyle}" Margin="8,0,0,0">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Spacing="8" Margin="0,0,0,12">
                            <Border 
                                Width="28" Height="28" 
                                CornerRadius="6"
                                Background="{StaticResource SuccessGradientBrush}">
                                <FontIcon 
                                    FontFamily="{StaticResource SymbolThemeFontFamily}" 
                                    Glyph="&#xE9D9;" 
                                    FontSize="12"
                                    Foreground="White"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"/>
                            </Border>
                            <TextBlock Text="Ping Stats" FontWeight="SemiBold" FontSize="14" VerticalAlignment="Center"/>
                        </StackPanel>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Min -->
                            <StackPanel HorizontalAlignment="Center">
                                <TextBlock Text="MIN" FontSize="10" Foreground="{ThemeResource TextFillColorSecondaryBrush}" HorizontalAlignment="Center"/>
                                <TextBlock FontSize="18" FontWeight="Bold" Foreground="{StaticResource SuccessBrush}" HorizontalAlignment="Center">
                                    <Run Text="{x:Bind ViewModel.MinPing, Mode=OneWay}"/><Run Text="ms" FontSize="10"/>
                                </TextBlock>
                            </StackPanel>

                            <!-- Max -->
                            <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                                <TextBlock Text="MAX" FontSize="10" Foreground="{ThemeResource TextFillColorSecondaryBrush}" HorizontalAlignment="Center"/>
                                <TextBlock FontSize="18" FontWeight="Bold" Foreground="{StaticResource ErrorBrush}" HorizontalAlignment="Center">
                                    <Run Text="{x:Bind ViewModel.MaxPing, Mode=OneWay}"/><Run Text="ms" FontSize="10"/>
                                </TextBlock>
                            </StackPanel>

                            <!-- Avg -->
                            <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                                <TextBlock Text="AVG" FontSize="10" Foreground="{ThemeResource TextFillColorSecondaryBrush}" HorizontalAlignment="Center"/>
                                <TextBlock FontSize="18" FontWeight="Bold" Foreground="{StaticResource PrimaryAccentBrush}" HorizontalAlignment="Center">
                                    <Run Text="{x:Bind FormatAvg(ViewModel.AvgPing), Mode=OneWay}"/><Run Text="ms" FontSize="10"/>
                                </TextBlock>
                            </StackPanel>

                            <!-- Loss -->
                            <StackPanel Grid.Row="1" HorizontalAlignment="Center" Margin="0,8,0,0">
                                <TextBlock Text="LOSS" FontSize="10" Foreground="{ThemeResource TextFillColorSecondaryBrush}" HorizontalAlignment="Center"/>
                                <TextBlock FontSize="18" FontWeight="Bold" Foreground="{x:Bind GetLossColor(ViewModel.PacketLoss), Mode=OneWay}" HorizontalAlignment="Center">
                                    <Run Text="{x:Bind FormatLoss(ViewModel.PacketLoss), Mode=OneWay}"/><Run Text="%" FontSize="10"/>
                                </TextBlock>
                            </StackPanel>

                            <!-- Success -->
                            <StackPanel Grid.Row="1" Grid.Column="1" HorizontalAlignment="Center" Margin="0,8,0,0">
                                <TextBlock Text="OK" FontSize="10" Foreground="{ThemeResource TextFillColorSecondaryBrush}" HorizontalAlignment="Center"/>
                                <TextBlock Text="{x:Bind ViewModel.SuccessCount, Mode=OneWay}" FontSize="18" FontWeight="Bold" Foreground="{StaticResource SuccessBrush}" HorizontalAlignment="Center"/>
                            </StackPanel>

                            <!-- Failed -->
                            <StackPanel Grid.Row="1" Grid.Column="2" HorizontalAlignment="Center" Margin="0,8,0,0">
                                <TextBlock Text="FAIL" FontSize="10" Foreground="{ThemeResource TextFillColorSecondaryBrush}" HorizontalAlignment="Center"/>
                                <TextBlock Text="{x:Bind ViewModel.FailCount, Mode=OneWay}" FontSize="18" FontWeight="Bold" Foreground="{StaticResource ErrorBrush}" HorizontalAlignment="Center"/>
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </Border>
            </Grid>

            <!-- Network Adapters Section -->
            <Border Grid.Row="2" Style="{StaticResource ModernCardStyle}" Margin="0,0,0,16">
                <StackPanel>
                    <StackPanel Orientation="Horizontal" Spacing="8" Margin="0,0,0,12">
                        <Border 
                            Width="28" Height="28" 
                            CornerRadius="6"
                            Background="{StaticResource InfoGradientBrush}">
                            <FontIcon 
                                FontFamily="{StaticResource SymbolThemeFontFamily}" 
                                Glyph="&#xE839;" 
                                FontSize="12"
                                Foreground="White"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"/>
                        </Border>
                        <TextBlock Text="Other Network Adapters" FontWeight="SemiBold" FontSize="14" VerticalAlignment="Center"/>
                    </StackPanel>

                    <ItemsControl ItemsSource="{x:Bind ViewModel.LocalLANCollection, Mode=OneWay}" MaxHeight="150">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Grid Margin="0,4" Padding="8" Background="{ThemeResource SubtleFillColorSecondaryBrush}" CornerRadius="6">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <FontIcon 
                                        FontFamily="{StaticResource SymbolThemeFontFamily}" 
                                        Glyph="&#xE839;" 
                                        FontSize="20"
                                        Margin="0,0,12,0"
                                        Foreground="{StaticResource PrimaryAccentBrush}"/>
                                    <StackPanel Grid.Column="1">
                                        <TextBlock Text="{Binding Name}" FontWeight="SemiBold" FontSize="13"/>
                                        <TextBlock Text="{Binding Description}" FontSize="11" Foreground="{ThemeResource TextFillColorSecondaryBrush}" TextTrimming="CharacterEllipsis"/>
                                    </StackPanel>
                                </Grid>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </Border>

            <!-- Chart Section -->
            <Border Grid.Row="3" Style="{StaticResource ModernCardStyle}" Margin="0,0,0,16" Padding="16" Height="120">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <StackPanel Orientation="Horizontal" Spacing="8" Margin="0,0,0,8">
                        <Border 
                            Width="24" Height="24" 
                            CornerRadius="6"
                            Background="{StaticResource AccentGradientBrush}">
                            <FontIcon 
                                FontFamily="{StaticResource SymbolThemeFontFamily}" 
                                Glyph="&#xE9D9;" 
                                FontSize="11"
                                Foreground="White"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"/>
                        </Border>
                        <TextBlock Text="Latency Graph" FontWeight="SemiBold" FontSize="13" VerticalAlignment="Center"/>
                    </StackPanel>
                    <Canvas x:Name="ChartCanvas" Grid.Row="1" SizeChanged="ChartCanvas_SizeChanged"/>
                </Grid>
            </Border>

            <!-- Ping Results Section -->
            <Border Grid.Row="4" Style="{StaticResource ModernCardStyle}" Padding="0" MinHeight="200">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Results Header -->
                    <Border 
                        Background="{ThemeResource SubtleFillColorSecondaryBrush}"
                        CornerRadius="8,8,0,0"
                        Padding="16,10">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon 
                                    FontFamily="{StaticResource SymbolThemeFontFamily}" 
                                    Glyph="&#xE9D9;" 
                                    FontSize="14"
                                    Foreground="{StaticResource PrimaryAccentBrush}"/>
                                <TextBlock Text="Ping Results" FontWeight="SemiBold" FontSize="13"/>
                            </StackPanel>
                            <TextBlock 
                                Grid.Column="1" 
                                FontSize="11"
                                Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                                <Run Text="{x:Bind ViewModel.PingCollection.Count, Mode=OneWay}"/>
                                <Run Text=" responses"/>
                            </TextBlock>
                        </Grid>
                    </Border>

                    <!-- Results List -->
                    <ListView
                        Grid.Row="1"
                        ItemsSource="{x:Bind ViewModel.PingCollection, Mode=OneWay}"
                        Padding="8"
                        SelectionMode="None"
                        MaxHeight="300">
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <Grid Padding="10,4" Margin="0,1">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Ellipse 
                                        Width="6" Height="6" 
                                        Margin="0,0,10,0"
                                        VerticalAlignment="Center"
                                        Fill="{Binding Time, Converter={StaticResource TextColorConverter}}"/>
                                    <TextBlock
                                        Grid.Column="1"
                                        Text="{Binding Response}"
                                        FontFamily="Cascadia Mono, Consolas, Courier New"
                                        FontSize="11"/>
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                        <ListView.ItemsPanel>
                            <ItemsPanelTemplate>
                                <ItemsStackPanel VerticalAlignment="Top" ItemsUpdatingScrollMode="KeepLastItemInView"/>
                            </ItemsPanelTemplate>
                        </ListView.ItemsPanel>
                        <ListView.ItemContainerStyle>
                            <Style TargetType="ListViewItem">
                                <Setter Property="Padding" Value="0"/>
                                <Setter Property="Margin" Value="0"/>
                                <Setter Property="MinHeight" Value="0"/>
                                <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                            </Style>
                        </ListView.ItemContainerStyle>
                    </ListView>

                    <!-- Empty State -->
                    <StackPanel 
                        Grid.Row="1"
                        HorizontalAlignment="Center" 
                        VerticalAlignment="Center"
                        Visibility="{x:Bind GetEmptyVisibility(ViewModel.PingCollection.Count), Mode=OneWay}">
                        <FontIcon 
                            FontFamily="{StaticResource SymbolThemeFontFamily}" 
                            Glyph="&#xE774;" 
                            FontSize="36"
                            Foreground="{ThemeResource TextFillColorTertiaryBrush}"/>
                        <TextBlock 
                            Text="No ping results yet" 
                            HorizontalAlignment="Center"
                            Margin="0,8,0,4"
                            FontWeight="SemiBold"
                            FontSize="12"/>
                        <TextBlock 
                            Text="Press F5 or click Start to begin" 
                            HorizontalAlignment="Center"
                            FontSize="10"
                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>
    </ScrollViewer>
</Page>
